function flashStim(){q_type=="choice"&&flashForSelect();var e=Math.floor(Math.random()*stimProbability*100);e>=100?flashStimulis(!1):flashStimulis(!0)}function flashStimulis(e){if(!e){counter++;var t=Math.floor(Math.random()*numOptions);while(recentOptions.indexOf(t)>=0)t=Math.floor(Math.random()*numOptions);recentOptions[counter%numRecentOptsToStore]=t;options[t].style.display="block";setTimeout(function(){options[t].style.display="none"},timeInterval)}else{stimcounter++;var t=Math.floor(Math.random()*numStim);while(recentStimOptions.indexOf(t)>=0)t=Math.floor(Math.random()*numStim);recentStimOptions[stimcounter%numRecentStimToStore]=t;if(stateIsPositive){console.log("flashing positive");posOptions[t].style.display="block";setTimeout(function(){posOptions[t%numStim].style.display="none"},timeInterval)}else{console.log("flashing negative");negOptions[t].style.display="block";setTimeout(function(){negOptions[t%numStim].style.display="none"},timeInterval)}}}function changeStimulis(e){if(stateIsPositive==e)return;console.log("reerse state");stateIsPositive=e}function flashForRange(e){this.rangeSlider=document.getElementById(e);this.isActive=!1;if(!this.rangeSlider)return;obj=this;this.rangeSlider.onmousedown=function(e){obj.mouseDown()};document.body.mouseup=function(e){this.mouseUp(e)}}function handleSliderOutput(e){target=parseInt(document.getElementById("target_value").innerHTML);if(!testType)return;if(isStandardStimulis){changeStimulis(!0);return}if(isNegativeTest){changeStimulis(!1);stimProbability=Math.abs(1*target/(1*target-e))*1;stimProbability*=stimProbability;stimProbability+=5;return}console.log("changing slider value. value:"+e+"  target: "+target);e<target?changeStimulis(!0):e>target&&changeStimulis(!1)}function flashForSelect(){if(!testType)return;if(isStandardStimulis){changeStimulis(!0);return}i=1;q_num=document.getElementById("q_num").innerHTML;var e=document.getElementById(q_num+"_"+i),t=document.getElementById("target_value").innerHTML,n;while(e){if(e.checked){n=e.value;console.log(n);break}i+=1;e=document.getElementById(q_num+"_"+i)}if(n!=targetValue){changeStimulis(!1);stimProbability=20}else changeStimulis(!0)}var options=[],posOptions=[],negOptions=[],timeInterval=5,recentOptions=[],recentStimOptions=[],numRecentOptsToStore=3,numRecentStimToStore=3,NUM_STIM_TYPES=0,counter=0,stimcounter=0,numRegOpts,numStim,numOptions,targetValue,stateIsPositive=!1,stimProbability=10,test,isNegativeTest=!1,isStandardStimulis=!1,q_type,testType;window.onload=function(){console.log("Initializing");document.getElementById("q_category")&&(q_type=document.getElementById("q_category").innerHTML);document.getElementById("target_value")&&(targetValue=document.getElementById("target_value").innerHTML);if(document.getElementById("test_type")){testType=document.getElementById("test_type").innerHTML;testField=document.getElementById("stimulus_type");console.log("test type: "+testType);switch(parseInt(testType)){case 0:stimProbability=1e5;testField.value="control";break;case 1:isStandardStimulis=!0;changeStimulis(!0);testField.value="std_pos";break;case 2:testField.value="dynamic_reg";break;case 3:isNegativeTest=!0;testField.value="dynamic_neg";break;default:testField.value="error"}}else{testType=0;isNegativeTest=!1}q_type=="range"&&(test=new flashForRange("value"));var e=document.getElementById("num-image");numRegOpts=parseInt(e.innerHTML);numStim=parseInt(document.getElementById("num-stim").innerHTML);numOptions=numRegOpts;numRecentOptsToStore=numRegOpts/2.5;numRecentStimToStore=numStim/2.5;var t=document.getElementById("submit-btn");t.disabled=!0;setTimeout(function(){t.disabled=!1},5e3);for(i=0;i<numRegOpts;i++){var n="cycle-"+i;options[i]=document.getElementById(n);options[i].style.display="none"}for(i=0;i<numStim;i++){var n="pos-"+i;posOptions[i]=document.getElementById(n);n="neg-"+i;negOptions[i]=document.getElementById(n)}setInterval(function(){flashStim()},timeInterval)};flashForRange.prototype.mouseDown=function(e){this.isActive=!0;this.rangeSlider.onmousemove=function(e){obj.mouseMove(e)};document.body.onmouseup=function(e){obj.mouseUp(e)}};flashForRange.prototype.mouseMove=function(e){var t=document.getElementById("slider-value");if(this.rangeSlider==document.activeElement&&this.isActive){t.innerHTML="Value: "+this.rangeSlider.value;handleSliderOutput(this.rangeSlider.value)}document.body.onmouseup=function(e){obj.mouseUp(e)}};flashForRange.prototype.mouseUp=function(e){this.isActive=!1};